<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Файл: За'аргул, Лич-Страж</title>
  <style>
    /* БАЗОВЫЙ СТИЛЬ СТРАНИЦЫ */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      color: #00ff66;
      font-family: Consolas, "Roboto Mono", monospace;
    }

    /* Matrix canvas background */
    #matrixCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
    }

    .wrapper {
      position: relative;
      min-height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
      z-index: 1;
    }

    .terminal {
      max-width: 900px;
      width: 100%;
      border: 1px solid #00aa44;
      padding: 20px 24px;
      box-sizing: border-box;
      background: radial-gradient(circle at top, #002200 0, #000 60%);
      box-shadow: 0 0 20px #00aa44;
      overflow: hidden;
    }

    .terminal-header {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      opacity: 0.7;
      margin-bottom: 8px;
    }

    /* ОБЛАСТЬ ВИДОВ (ЭКРАНОВ) */
    .views {
      position: relative;
      height: 260px;
      overflow: hidden;
      transition: height 0.6s ease;
    }

    .views.expanded {
      /* height: 700px; */ /* Убрали фиксированную высоту - будет подстраиваться под содержимое */
    }

    .views-inner {
      position: relative;
      width: 100%;
      min-height: 260px;
      transform: translateY(0);
      transition: transform 0.6s ease;
    }

    .view {
      box-sizing: border-box;
      width: 100%;
      min-height: 260px;
      padding-top: 4px;
    }

    #view-biometrics,
    #view-protocols,
    #view-dossier {              /* <<< НОВОЕ: добавили dossier */
      padding-top: 255px;
    }

    #view-biometrics .buttons-row,
    #view-protocols .buttons-row,
    #view-dossier .buttons-row { /* <<< НОВОЕ: общий стиль */
      margin-top: 0;
      margin-bottom: 20px;
    }

    /* ОБЩИЙ БЛОК ТЕКСТА — БЕЗ СКРОЛЛА */
    .terminal-body {
      white-space: pre-wrap;
      font-size: 16px;
      line-height: 1.4;
      min-height: 190px;
      overflow-y: hidden;        /* <<< ВАЖНО: тут скролл убираем */
    }

    /* СКРОЛЛ ТОЛЬКО ДЛЯ ЛИЧНОГО ДЕЛА */
    #dossier-body {               /* <<< НОВОЕ */
      max-height: 400px;          /* ограничиваем высоту */
      overflow-y: auto;           /* внутренний скролл только здесь */
    }

    #attachmentCanvas {
      width: 100%;
      max-width: 800px;
      border: 1px solid #00aa44;
      margin-top: 20px;
      box-shadow: 0 0 12px #00ff66;
    }

    .cursor {
      display: inline-block;
      width: 9px;
      height: 18px;
      background-color: #00ff66;
      margin-left: 2px;
      animation: blink 0.8s steps(1) infinite;
      vertical-align: bottom;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    /* КНОПКИ-РАЗДЕЛЫ */
    .buttons-row {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .nav-btn {
      position: relative;
      padding: 10px 16px;
      border-radius: 4px;
      border: 1px solid #00aa44;
      background: rgba(0, 20, 0, 0.9);
      color: #00ff99;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      cursor: pointer;
      text-decoration: none;
      filter: drop-shadow(0 0 6px #004422);
      overflow: hidden;

      /* ВАЖНО: изначально скрыты */
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.4s ease, transform 0.4s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    .nav-btn::before {
      content: "";
      position: absolute;
      left: -40%;
      top: 0;
      width: 40%;
      height: 100%;
      background: linear-gradient(120deg, transparent, rgba(0, 255, 153, 0.35), transparent);
      transform: skewX(-20deg);
      opacity: 0;
    }

    .nav-btn:hover {
      box-shadow: 0 0 10px #00ff99;
      background: rgba(0, 40, 0, 0.95);
    }

    .nav-btn:hover::before {
      animation: shine 0.7s forwards;
      opacity: 1;
    }

    @keyframes shine {
      from { transform: translateX(-120%) skewX(-20deg); }
      to   { transform: translateX(200%) skewX(-20deg); }
    }

    .nav-btn.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* Чуть приглушённая кнопка "Назад" */
    .nav-btn.back {
      border-color: #008844;
      color: #66ffcc;
      text-transform: none;
      letter-spacing: 0.03em;

      /* главное: она не скрыта */
      opacity: 1;
      transform: translateY(0);
    }

    @media (max-width: 600px) {
      .terminal {
        padding: 16px 14px;
      }

      .views {
        position: relative;
        height: 340px;
        overflow: hidden;
      }

      .view {
        box-sizing: border-box;
        width: 100%;
        min-height: 260px;
        padding-top: 0;
        display: flex;              /* делаем колонку */
        flex-direction: column;
      }

      .terminal-body {
        white-space: pre-wrap;
        font-size: 16px;
        line-height: 1.4;
        flex: 1;                    /* занимает всё свободное место */
        overflow-y: hidden;         /* по умолчанию без скролла */
      }

      #dossier-body {           /* но для личного дела включаем */
        overflow-y: auto;
      }

      .buttons-row {
        flex-direction: column;
      }
      .nav-btn {
        width: 100%;
        text-align: center;
      }
    }

    /* Спец-оформление протоколов */
    .protocol-red {
      color: #ff3333;
    }

    .protocol-strike {
      text-decoration: line-through;
      opacity: 0.85;
    }

  </style>
</head>
<body>
  <canvas id="matrixCanvas"></canvas>
  
  <div class="wrapper">
    <div class="terminal">
      <div class="terminal-header">
        <div>НЕКРОНТИР / ИНФО-ИМИТАТОР</div>
        <div>УРОВЕНЬ ДОПУСКА: &Omega;-ВЕРИТАС</div>
      </div>

      <div class="views">
        <div class="views-inner" id="views-inner">
          <!-- ====== ЭКРАН ОБЗОРА ====== -->
          <section class="view" id="view-overview">
            <div id="overview-body" class="terminal-body"></div>

            <div class="buttons-row">
              <button class="nav-btn" data-target="biometrics">
                Биометрическая Идентификация
              </button>
              <button class="nav-btn" data-target="protocols">
                Протоколы
              </button>
              <button class="nav-btn" data-target="dossier">
                Личное Дело
              </button>
              <button class="nav-btn" data-target="attachments">
                Приложения
              </button>
            </div>
          </section>

          <!-- ====== ЭКРАН БИОМЕТРИИ ====== -->
          <section class="view" id="view-biometrics">
            <div class="buttons-row">
              <button class="nav-btn back" data-target="overview">
                &laquo; ВЕРНУТЬСЯ К ОБЗОРУ ФАЙЛА
              </button>
            </div>
            <div id="biometrics-body" class="terminal-body"></div>
          </section>

          <!-- ====== ЭКРАН ПРОТОКОЛОВ ====== -->
          <section class="view" id="view-protocols">
            <div class="buttons-row">
              <button class="nav-btn back" data-target="overview">
                &laquo; ВЕРНУТЬСЯ К ОБЗОРУ ФАЙЛА
              </button>
            </div>
            <div id="protocols-body" class="terminal-body"></div>
          </section>

          <!-- ====== ЭКРАН ЛИЧНОГО ДЕЛА ====== -->
          <section class="view" id="view-dossier">   <!-- <<< НОВОЕ -->
            <div class="buttons-row">
              <button class="nav-btn back" data-target="overview">
                &laquo; ВЕРНУТЬСЯ К ОБЗОРУ ФАЙЛА
              </button>
            </div>
            <div id="dossier-body" class="terminal-body"></div>
          </section>

          <!-- ====== ЭКРАН ПРИЛОЖЕНИЙ ====== -->
          <section class="view" id="view-attachments">
            <div class="buttons-row">
              <button class="nav-btn back" data-target="overview">
                &laquo; ВЕРНУТЬСЯ К ОБЗОРУ ФАЙЛА
              </button>
            </div>
            <div id="attachments-body" class="terminal-body"></div>
            <div id="apps-image-container"
                 style="width:100%; overflow:hidden; margin-top:20px;"></div>
            <canvas id="attachmentCanvas" width="600" height="400" style="display:none;"></canvas>
          </section>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ---------- MATRIX BACKGROUND ---------- */
    const canvas = document.getElementById("matrixCanvas");
    const ctx = canvas.getContext("2d");

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    const symbols = "アイウエオカキクケコサシスセソ0123456789ネクロンҨҖӜЖ☥";
    const fontSize = 16;
    let columns = Math.floor(window.innerWidth / fontSize);
    let drops = Array.from({ length: columns }, () => Math.random() * window.innerHeight);

    function drawMatrix() {
      ctx.fillStyle = "rgba(0, 0, 0, 0.07)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#00ff66";
      ctx.font = fontSize + "px Consolas";

      drops.forEach((y, i) => {
        const text = symbols.charAt(Math.random() * symbols.length);
        const x = i * fontSize;

        ctx.fillText(text, x, y * fontSize);

        if (y * fontSize > canvas.height && Math.random() > 0.975) {
          drops[i] = 0;
        }
        drops[i]++;
      });

      requestAnimationFrame(drawMatrix);
    }
    drawMatrix();

    /* ---------- ТЕКСТ ОБЗОРА ---------- */
    const overviewLines = [
      ">> ИНИЦИАЛИЗАЦИЯ ДОСТУПА К АРХИВУ...",
      ">> ПОИСК ФАЙЛА: ЗА'АРГУЛ...",
      ">> СТАТУС: АКТИВЕН   |   РЕГАЛИЯ: СВИТА РЕГЕНТА",
      ">> ДИНАСТИЯ: [ДАННЫЕ ЗАШИФРОВАНЫ]   |   МИР-ГРОБНИЦА: [ДАННЫЕ ЗАШИФРОВАНЫ]",
      ">> ФУНКЦИЯ: ПЕРВЫЙ МЕЧ, ЛИЧ-СТРАЖА, ИСПОЛНИТЕЛЬ ПРИГОВОРОВ",
      ">> ПРЕДВАРИТЕЛЬНЫЙ ОБЗОР ФАЙЛА ЗАГРУЖЕН."
    ];

    /* ---------- ТЕКСТ БИОМЕТРИИ / АВТОРИЗАЦИИ ---------- */
    const biometricsLines = [
      ">> ДОСТУП К ПОДРАЗДЕЛУ: БИОМЕТРИЧЕСКАЯ ИДЕНТИФИКАЦИЯ...",
      ">> ПОДТВЕРЖДЕНИЕ УРОВНЯ ДОПУСКА: ОДОБРЕНО.",
      ">> ЗАГРУЗКА ТЕЛЕСНЫХ ПАРАМЕТРОВ: ЗА'АРГУЛ...",
      "",
      "   ИДЕНТИФИКАТОР: ЗА'АРГУЛ",
      "   ТЕЛЕСНАЯ ФОРМА: НЕКРОДЕРМИС, ФАЗОВО УСТОЙЧИВАЯ",
      "      ЛОКАЛЬНЫЕ ПОВРЕЖДЕНИЯ: УСТРАНЕНЫ АВТО-РЕФОРМАЦИЕЙ",
      "      СОСТОЯНИЕ НЕКРОДЕРМИСА: ОПТИМАЛЬНОЕ [ПОВЕРХНОСТНЫЕ СЛОИ ОКИСЛЕНЫ]",
      "      ПСИХО-ФИЗИЧЕСКОЕ СОСТОЯНИЕ: НЕСТАБИЛЬНОЕ[!]",
      "   РАНГ ВОИНА: ЛИЧ-СТРАЖ РЕГЕНТА",
      "   СТАТУС РЕАКТИВАЦИИ: НЕПРЕРЫВНЫЙ БОЕВОЙ РЕЖИМ",
      "   ВЫСОТА: 2.75 МЕТРА",
      "   ВЕС: 680 КИЛОГРАММ",
      "   ВОЗРАСТ: 60,049,147 лет",
      "   В ПОДЧИНЕНИИ: РЕГЕНТУ ТИРАНХУ",
      "   ИЗВЕСТНЫЕ ПРОЗВИЩА: МЕСТЬ НЕКРОНТИРА, УБИЙЦА РОДА",
      "",
      ">> КОНЕЦ БИОМЕТРИЧЕСКОЙ ИДЕНТИФИКАЦИИ."
    ];

    /* ---------- ТЕКСТ ПРОТОКОЛОВ ---------- */
    // const protocolsLines = [
    //   ">> ДОСТУП К ПОДРАЗДЕЛУ: ПРОТОКОЛЫ...",
    //   ">> ПОДТВЕРЖДЕНИЕ УРОВНЯ ДОПУСКА: ОДОБРЕНО.",
    //   ">> ЗАГРУЗКА ПРОТОКОЛОВ ЛИЧ-СТРАЖА...",
    //   "",
    //   "   ПЕРВЫЙ ПРОТОКОЛ: ВЫПОЛНЕНИЕ ПРИКАЗА РЕГЕНТА.",
    //   "",
    //   "   ВТОРОЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ ДЕФЕКТНЫХ НЕКРОН-ЕДИНИЦ.",
    //   "",
    //   ">> СПИСОК ПРОТОКОЛОВ ГОТОВ К ПРОСМОТРУ."
    // ];

    /* ---------- ТЕКСТ ЛИЧНОГО ДЕЛА ---------- */
    const dossierLines = [
      ">> ДОСТУП К ПОДРАЗДЕЛУ: ЛИЧНОЕ ДЕЛО...",
      ">> ПОДТВЕРЖДЕНИЕ УРОВНЯ ДОПУСКА: ОДОБРЕНО.",
      ">> ЗАГРУЗКА ЛИЧНОГО ДЕЛА: ЗА'АРГУЛ...",
      "",
      "   ДОСЬЕ: ЗА'АРГУЛ",
      "   РОЛЬ: СВИТА РЕГЕНТА ТИРАНХА, ЛИЧ-СТРАЖА.",
      "",
      "   ПСИХО-ПРОФИЛЬ:",
      "     > Абсолютная преданность голосу Регента.",
      "     > При отсутствии прямого приказа проявляет стойкую агрессию к любой некрон-единице. [!]",
      "     > Зафиксированы многомиллионолетние периоды одиночной службы.",
      "     > Проявляет неестественную привязанность к каноптек-конструкциям.",
      "     > Отсутствие жалости к врагам и сородичам.",
      "",
      "",
      "   БИОГРАФИЯ:",
      "     > Когда Некронтир ещё носили бренную плоть, а их дни были коротки, как вспышка",
      "     тусклой звезды, жил один, чьи глаза видели глубже, чем позволяла его природа.",
      "",
      "     > Дом его был мал и незнатен, но его ум стал ценнее всех древних родословных.",
      "     За’аргул обладал странным даром математическим видением неизбежного —",
      "     способностью высчитывать будущие события с ужасающей точностью.",
      "     И только один правитель прислушивался к его словам:",
      "     Тиранх, будущий владыка его Династии.",
      "     > За’аргул стал его личным прозорцем, показывая политические движения, ",
      "     траектории войн, и — главное — тень, нависшую над ними всеми.",
      "",
      "     > Когда К’тан протянули свой “дар”, и некронтиры дрогнули перед обещанной вечностью,",
      "     Слова За’аргула прозвучали как кощунство — и как угроза планам великих династий.",
      "     Его слова могли убедить Тиранха отказаться и пойти против воли Молчаливого Короля.",
      "     > Чтобы заставить замолчать того, кто говорил об ужасах будущего,",
      "     враги Тиранха пленили За’аргула в биосаркофаг и заставили его пройти био-трансформацию.",
      "     > В тайне от своего господина и вопреки своей воле, За’аргул был предан бессмертию.",
      "",
      "     > Когда его тело разрывало на молекулы, когда сознание дробилось на ослепительные вспышки",
      "     боли, За’аргул терял видение того, что будет, и устремлял взгляд на то, что было.",
      "     > Какие страдания его заставили пройти, какие муки он вынес.",
      "     > Когда его глаза активировались, он чувствовал только ярость и слышал только свой крик.",
      "     > Он увидел вечность, состоящую из одиночества, боли и пустоты.",
      "     И этот образ выжег его разум сильнее, чем сама био-трансформация.",
      "",
      "     > За’аргул пробудился:",
      "          > с сохранившейся эмоциональной матрицей,",
      "          > с несглаженными воспоминаниями о боли,",
      "          > с пророческим ядром, сломанным и усиленным,",
      "          > с ненавистью, пылающей ярче звезды.",
      "",
      "     > Он убил семерых техников прежде, чем они успели ввести аварийный протокол.",
      "     Его крики резали эфир, а живой металл на его руках капал чужой кровью.",
      "",
      "     > И всё же он остановился. Когда услышал голос своего господина:",
      "     > [ИНФОРМАЦИЯ УДАЛЕНА: ПРИКАЗ РЕГЕНТА]",
      "     > Он почувствова счастье и покой, которых не испытывал с момента трансформации.",
      "     > Очнулся он над уничтоженным телом Лич-Стража перед господином.", 
      "     > Он не знал, как он смог одолеть великую свиту, однако как его глаза пали на другого...", 
      "          > ЯРОСТЬ.", 
      "          > НЕНАВИСТЬ.", 
      "          > [ПЕРВЫЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ.]",
      "     > Не успев и дрогнуть с места, как голос господина остановил его.",
      "     — Стой.",
      "          > ПЕРВЫЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ. ПЕРЕЗАПИСЬ ПРИОРИТЕТА.",
      "",
      "     — Да, господин.",
      "",
      "     > С того дня, За’аргул служит своему господину с неукротимой яростью и преданностью.",
      "     > Увидев его таланты, Тиранх позволил ему служить в своей свите.",
      "          > [ПРИМЕЧАНИЕ-1].", 
      "",
      "     > За'аргул, ранее великий пророк, стал стражником своего единственного идола.",
      "     > В течении следующих тысяч лет, он выполнял каждое задание господина с 100% успешностью.",
      "     > Тот же в свою очередь, радовал За'аргула новыми заданиями, не давая его рассудку пасть",
      "     до уровня уничтожителя, желающим уничтожить всех некронов у себя на глазах.",
      "     > Однако он понимал, что полезный монстр всегда останется монстром,",
      "     потому не имел много надежд на его исправление.",
      "",
      "     > Когда пришло время идти в далёкий сон, Тиранх принял решение:",
      "          > оставить За'аргула на страже своего саркофага,",
      "          > и своего первого стража - Якх-Кхфея.",
      "",
      "     > Прошло много эонов, и За'аргул оставался на страже.",
      "     > Однако, когда великий Тиранх очнулся из своей дрёмы, он не обнаружил",
      "     За'аргула потерянным",
      "     > Всё то время, он делил с другими стражами монолита - каноптек-конструкциями,",
      "     которых он принял, и, если считать, что бездушное чудовище на то способно,",
      "     полюбил...",
      "",
      "",
      "   ПРИМЕЧАНИЯ:",
      "     > [ПРИМЕЧАНИЕ-1]: Комментарий Тиранха:",
      "          > 'Он сражался с яростью уничтожителя, безумством освежевателя, ",
      "          и холодом духа. А сила его была сравнима со всеми тремя.'",
      "",
      ">> ЛИЧНОЕ ДЕЛО: ЗАГРУЗКА ЗАВЕРШЕНА."
    ];

    /* ---------- ТЕКСТ ПРИЛОЖЕНИЙ ---------- */
    const attachmentLines = [
      ">> ДОСТУП К ПОДРАЗДЕЛУ: ПРИЛОЖЕНИЯ...",
      ">> ПОДТВЕРЖДЕНИЕ УРОВНЯ ДОПУСКА: ОДОБРЕНО.",
      ">> ЗАГРУЗКА ПРИЛОЖЕНИЯ-1...",
      ""
    ];

    // const typingSpeed = 15;
    // const linePause = 200;

    const typingSpeed = 1;
    const linePause = 2;

    /* ---------- ОБЗОР: АНИМАЦИЯ ПЕЧАТИ ---------- */
    const overviewBody = document.getElementById("overview-body");
    const overviewCursor = document.createElement("span");
    overviewCursor.className = "cursor";
    overviewBody.appendChild(overviewCursor);

    let ovLineIndex = 0;
    let ovCharIndex = 0;
    let ovCurrentText = "";

    function typeOverview() {
      const line = overviewLines[ovLineIndex];

      if (ovCharIndex < line.length) {
        ovCurrentText += line[ovCharIndex];
        renderOverview();
        ovCharIndex++;
        setTimeout(typeOverview, typingSpeed);
      } else {
        ovCurrentText += "\n";
        renderOverview();
        ovLineIndex++;
        ovCharIndex = 0;

        if (ovLineIndex < overviewLines.length) {
          setTimeout(typeOverview, linePause);
        } else {
          showOverviewButtons();
        }
      }
    }

    function renderOverview() {
      overviewBody.innerHTML = "";
      overviewBody.appendChild(document.createTextNode(ovCurrentText));
      overviewBody.appendChild(overviewCursor);
    }

    function showOverviewButtons() {
      const buttons = document.querySelectorAll("#view-overview .nav-btn");
      buttons.forEach((btn, i) => {
        setTimeout(() => {
          btn.classList.add("show");
        }, 200 * i);
      });
    }

    /* ---------- БИОМЕТРИЯ ---------- */
    const biometricsBody = document.getElementById("biometrics-body");
    const biometricsCursor = document.createElement("span");
    biometricsCursor.className = "cursor";

    let bioLineIndex = 0;
    let bioCharIndex = 0;
    let bioCurrentText = "";
    let biometricsStarted = false;

    function startBiometricsTyping() {
      if (biometricsStarted) return;
      biometricsStarted = true;

      biometricsBody.innerHTML = "";
      bioLineIndex = 0;
      bioCharIndex = 0;
      bioCurrentText = "";
      biometricsBody.appendChild(biometricsCursor);
      typeBiometrics();
    }

    function typeBiometrics() {
      const line = biometricsLines[bioLineIndex];

      if (bioCharIndex < line.length) {
        bioCurrentText += line[bioCharIndex];
        renderBiometrics();
        bioCharIndex++;
        setTimeout(typeBiometrics, typingSpeed);
      } else {
        bioCurrentText += "\n";
        renderBiometrics();
        bioLineIndex++;
        bioCharIndex = 0;

        if (bioLineIndex < biometricsLines.length) {
          setTimeout(typeBiometrics, linePause);
        }
      }
    }

    function renderBiometrics() {
      biometricsBody.innerHTML = "";
      biometricsBody.appendChild(document.createTextNode(bioCurrentText));
      biometricsBody.appendChild(biometricsCursor);
    }

        // Случайные приказы Регента
        /* ---------- ПРОТОКОЛЫ: АНИМАЦИЯ ---------- */
    const protocolsBody = document.getElementById("protocols-body");
    const protocolsCursor = document.createElement("span");
    protocolsCursor.className = "cursor";

    const protocolsHeaderLines = [
      ">> ДОСТУП К ПОДРАЗДЕЛУ: ПРОТОКОЛЫ...",
      ">> ПОДТВЕРЖДЕНИЕ УРОВНЯ ДОПУСКА: ОДОБРЕНО.",
      ">> ЗАГРУЗКА ПРОТОКОЛОВ: ЗА'АРГУЛ...",
      ""
    ];

    let protocolsStarted = false;
    let protocolsTimers = [];

    // индексы для печати заголовка
    let phLineIndex = 0;
    let phCharIndex = 0;
    let phCurrentText = "";

    /* ---------- СЛУЧАЙНЫЕ ПРИКАЗЫ РЕГЕНТА ---------- */
    const necronOrders = [
      "СТЕРЕТЬ ЛЮБОЕ ОРГАНИЧЕСКОЕ ПРИСУТСТВИЕ В СЕКТОРЕ VII.",
      "ИЗЪЯТЬ ВСЕ КСЕНОТЕХ-АРТЕФАКТЫ ДЛЯ ПОСЛЕДУЮЩЕЙ ПЕРЕРАБОТКИ.",
      "ПЕРЕНАСТРОИТЬ ГЕНОЦИДНЫЕ ЛУЧИ НА ЧАСТОТУ ОМЕГА-13.",
      "РАЗОРУЖИТЬ ПОДРАЗДЕЛЕНИЯ, ПОКАЗАВШИЕ ПРИЗНАКИ ИНИЦИАТИВЫ.",
      "ПРОВЕСТИ ПОЛНУЮ САНАЦИЮ МИРА-УЛЬЯ ОТ СПОРОВ ТИРАНИД.",
      "ПОГАСИТЬ ВСЕ ЗВЁЗДЫ ПОДМАТРИЦЫ ТАУ-СИГМА.",
      "ЗАХВАТИТЬ ПЛЕННЫХ АЭЛЬДАР ДЛЯ ЭКСПЕРИМЕНТАЛЬНОЙ ДИССЕКЦИИ.",
      "ДЕАКТИВИРОВАТЬ НЕИСПРАВНЫЕ НЕКРОН-ВОИНЫ ПУТЁМ ДЕМАТЕРИАЛИЗАЦИИ.",
      "СМЕСТИТЬ ТЕКУЩЕГО ПОВЕЛИТЕЛЯ СЕКТОРА ЗА ПРОЯВЛЕННУЮ СЛАБОСТЬ.",
      "ПЕРЕНАПРАВИТЬ ЭНЕРГИЮ ОБЕЛИСКОВ В РЕЗЕРВ РЕГЕНТА.",
      "ОБРУШИТЬ ОРБИТАЛЬНЫЕ ОБЕЛИСКИ НА КООРДИНАТЫ ВРАЖЕСКОГО ШТАБА.",
      "УНИЧТОЖИТЬ ВСЕ ХРАНИЛИЩА ФЛЕШ-ПАМЯТИ ОРГАНИКОВ.",
      "ОСКВЕРНИТЬ СВЯТЫНИ ИМПЕРИУМА ЧЕРЕЗ ФАЗОВЫЕ РАЗЛОМЫ.",
      "ПЕРЕПИСАТЬ МАТРИЦЫ ПОДЧИНЕНИЯ У ВСЕХ ЛИЧ-СТРАЖЕЙ.",
      "ЗАХВАТИТЬ ЖИВЫМИ ВЫСОКОПСИОНИКОВ ДЛЯ ВСКРЫТИЯ ИХ РАЗУМА.",
      "СТЕРЕТЬ ИЗ ХРОНИК ЛЮБЫЕ УПОМИНАНИЯ О ПОРАЖЕНИЯХ ДИНАСТИИ.",
      "ЗАПЕЧАТАТЬ ВСЕ ВАРП-АНОМАЛИИ ПОД КОНТРОЛЕМ ДИНАСТИИ.",
      "ИЗОЛИРОВАТЬ ЗАРАЖЁННЫЕ НЕКРОН-ЕДИНИЦЫ В ТЕССЕРАКТОВЫХ ЛАБИРИНТАХ.",
      "ПОДЧИНИТЬ МЕСТНЫЕ ТЕХНО-АРТЕФАКТЫ ЕДИНОМУ ПРОТОКОЛУ.",
      "СМЕСТИТЬ ОРБИТУ ПЛАНЕТЫ ДЛЯ ОПТИМИЗАЦИИ ТРАЕКТОРИЙ ОГНЯ.",
      "ПОГРУЗИТЬ МИР-УЛЕЙ В ВЕЧНУЮ НОЧЬ.",
      "ПРОВЕСТИ ТОТАЛЬНУЮ ФАЗОВУЮ ЧИСТКУ НИЖНИХ УРОВНЕЙ.",
      "ПРИНЕСТИ РЕГЕНТУ ГОЛОВУ МЕСТНОГО «СВЯТОГО» В КРИОСТАЗЕ.",
      "РАЗВЕРНУТЬ КАНОПТЕК-РОИ ДЛЯ ПОЛНОЙ РЕКОГНОСЦИРОВКИ СЕКТОРА.",
      "ИЗЪЯТЬ У ВАССАЛЬНЫХ МИРОВ ПРАВО НА АВТОНОМНЫЕ РЕШЕНИЯ.",
      "ЗАПРЕТИТЬ ЛЮБОЕ ИСПОЛЬЗОВАНИЕ ВАРП-ДВИГАТЕЛЕЙ В СЕКТОРЕ.",
      "ПЕРЕУПАКОВАТЬ ДУШИ ПАВШИХ В ЭНЕРГОЯЧЕЙКИ.",
      "ИСПЕПЕЛИТЬ СИНТЕТИЧЕСКИЕ РЕЛИГИОЗНЫЕ ОБЪЕКТЫ ОРГАНИКОВ.",
      "ДЕСТАБИЛИЗИРОВАТЬ ЯДРО МИРА С ПОСЛЕДУЮЩИМ КОНТРОЛИРУЕМЫМ РАСКОЛОМ.",
      "УНИЧТОЖИТЬ ФЛОТ ВТОРЖЕНИЯ ДО ВЫХОДА ИЗ ВАРПА.",
      "ЗАКЛЕЙМИТЬ ЧУЖДЫЕ ИИ КАК ПОДЛЕЖАЩИЕ УТИЛИЗАЦИИ.",
      "ПЕРЕНАЗНАЧИТЬ ПРИОРИТЕТЫ: СНАЧАЛА РЕГЕНТ, ЗАТЕМ МИРЫ-СКЛЕПЫ.",
      "ПРОВЕСТИ ИСПЫТАНИЕ НОВОГО ПРОТОКОЛА ОБНУЛЕНИЯ ЛИЧНОСТИ.",
      "СБРОСИТЬ ПАМЯТЬ У ВСЕХ СВИДЕТЕЛЕЙ ПРОШЛЫХ ПОРАЖЕНИЙ.",
      "СБРОСИТЬ АВТОНОМИЮ У ПОДЧИНЁННЫХ ОВЕРЛОРДОВ.",
      "ПРОВЕСТИ ОПЕРАЦИЮ МОЛНИЕНОСНОГО ОБЕЗГЛАВЛИВАНИЯ КОМАНДОВАНИЯ ВРАГА.",
      "ПЕРЕНАПРАВИТЬ НЕКРОН-ФАЛАНГИ НА ЗАЩИТУ САРКОФАГА РЕГЕНТА.",
      "ПРОВЕРИТЬ ЛОЯЛЬНОСТЬ ЛИЧ-СТРАЖЕЙ ЧЕРЕЗ БОЕВОЕ ИСПЫТАНИЕ.",
      "АКТИВИРОВАТЬ РЕЗЕРВНЫЕ ЛЕГИОНЫ СПЯЩИХ ФАЛАНГ.",
      "ЛИКВИДИРОВАТЬ ЛЮБЫХ ПСАЙКЕРОВ В ЗОНЕ БОЕВЫХ ДЕЙСТВИЙ.",
      "ОТКЛЮЧИТЬ ПРОТОКОЛ ОТСТУПЛЕНИЯ НА ВСЕХ ФРОНТАХ.",
      "РАЗВЕРНУТЬ СЕТЬ СКРЫТЫХ ФАЗОВЫХ МИН.",
      "ПОДГОТОВИТЬ ТРОННЫЙ МИР К ВИЗИТУ ОСКОЛКА К'ТАН.",
      "УСТАНОВИТЬ МАЯК ВЕЧНОГО ВЛАДЫЧЕСТВА РЕГЕНТА НАД ЭТИМ СЕКТОРОМ."
      // можешь добавить ещё, сколько захочешь
    ];

    function getRandomOrder() {
      return necronOrders[Math.floor(Math.random() * necronOrders.length)];
    }

    /* ---------- ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ---------- */
    function clearProtocolsTimers() {
      protocolsTimers.forEach(id => clearTimeout(id));
      protocolsTimers = [];
    }

    function scheduleProtocols(fn, delay) {
      const id = setTimeout(fn, delay);
      protocolsTimers.push(id);
    }

    /* ---------- ЗАПУСК ПРОТОКОЛОВ ---------- */
    function startProtocolsTyping() {
      if (protocolsStarted) return;
      protocolsStarted = true;
      clearProtocolsTimers();

      protocolsBody.innerHTML = "";
      phLineIndex = 0;
      phCharIndex = 0;
      phCurrentText = "";

      protocolsBody.appendChild(protocolsCursor);
      typeProtocolsHeader();
    }

    /* ---------- ПЕЧАТЬ ЗАГОЛОВКА ПРОТОКОЛОВ ---------- */
    function typeProtocolsHeader() {
      if (!protocolsStarted) return;

      const line = protocolsHeaderLines[phLineIndex];

      if (phCharIndex < line.length) {
        phCurrentText += line[phCharIndex];
        renderProtocolsHeader();
        phCharIndex++;
        setTimeout(typeProtocolsHeader, typingSpeed);
      } else {
        phCurrentText += "\n";
        renderProtocolsHeader();
        phLineIndex++;
        phCharIndex = 0;

        if (phLineIndex < protocolsHeaderLines.length) {
          setTimeout(typeProtocolsHeader, linePause);
        } else {
          // заголовок закончен — убираем курсор и запускаем цикл состояний
          protocolsBody.removeChild(protocolsCursor);

          const dyn = document.createElement("div");
          protocolsBody.appendChild(dyn);

          runProtocolsStates(dyn);
        }
      }
    }

    function renderProtocolsHeader() {
      protocolsBody.innerHTML = "";
      protocolsBody.appendChild(document.createTextNode(phCurrentText));
      protocolsBody.appendChild(protocolsCursor);
    }

    /* ---------- ЦИКЛ СОСТОЯНИЙ ПРОТОКОЛОВ ---------- */
    function runProtocolsStates(dyn) {
      if (!protocolsStarted) return;

      dyn.innerHTML = "";
      let t = 0;

      const currentOrder = getRandomOrder().toUpperCase();

      // 1) исходный протокол
      scheduleProtocols(() => {
        dyn.innerHTML =
          "   ПЕРВЫЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ.";
      }, (t += 200));

      // 2) красный + ПЕРЕЗАПИСЬ ПРИОРИТЕТА
      scheduleProtocols(() => {
        dyn.innerHTML =
          `<span class="protocol-red">   ПЕРВЫЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ. ПЕРЕЗАПИСЬ ПРИОРИТЕТА.</span>`;
      }, (t += 1200));

      // 3) красный зачёркнутый
      scheduleProtocols(() => {
        dyn.innerHTML =
          `<span class="protocol-red protocol-strike">   ПЕРВЫЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ. ПЕРЕЗАПИСЬ ПРИОРИТЕТА.</span>`;
      }, (t += 1200));

      // 4) новый набор протоколов + ПРИКАЗ РЕГЕНТА (длинная пауза перед этим)
      scheduleProtocols(() => {
        dyn.innerHTML =
          "   ПЕРВЫЙ ПРОТОКОЛ: ВЫПОЛНЕНИЕ ПРИКАЗА РЕГЕНТА.<br>" +
          `      ПРИКАЗ РЕГЕНТА: ${currentOrder}<br><br>` +
          "   ВТОРОЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ.";
      }, (t += 1200));   // <<< УВЕЛИЧЕННАЯ ПАУЗА

      // 5) ВЫПОЛНЕНО + тот же приказ
      scheduleProtocols(() => {
        dyn.innerHTML =
          "   ПЕРВЫЙ ПРОТОКОЛ: ВЫПОЛНЕНИЕ ПРИКАЗА РЕГЕНТА. ВЫПОЛНЕНО.<br>" +
          `      ПРИКАЗ РЕГЕНТА: ${currentOrder}<br><br>` +
          "   ВТОРОЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ.";
      }, (t += 3500));

      // 6) зачёркиваем ПЕРВЫЙ ПРОТОКОЛ и ПРИКАЗ
      scheduleProtocols(() => {
        dyn.innerHTML =
          `   <span class="protocol-strike">ПЕРВЫЙ ПРОТОКОЛ: ВЫПОЛНЕНИЕ ПРИКАЗА РЕГЕНТА. ВЫПОЛНЕНО.</span><br>` +
          `   <span class="protocol-strike">   ПРИКАЗ РЕГЕНТА: ${currentOrder}</span><br><br>` +
          "   ВТОРОЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ.";
      }, (t += 1500));

      // 7) итог — только один протокол
      scheduleProtocols(() => {
        dyn.innerHTML =
          "   ПЕРВЫЙ ПРОТОКОЛ: УНИЧТОЖЕНИЕ НЕКРОН-ЕДИНИЦ.";
      }, (t += 1500));

      // 8) перезапускаем цикл
      scheduleProtocols(() => {
        if (protocolsStarted) {
          runProtocolsStates(dyn);
        }
      }, (t += 2000));
    }


    /* ---------- ЛИЧНОЕ ДЕЛО ---------- */
    const dossierBody = document.getElementById("dossier-body");
    const dossierCursor = document.createElement("span");
    dossierCursor.className = "cursor";

    let dossierLineIndex = 0;
    let dossierCharIndex = 0;
    let dossierCurrentText = "";
    let dossierStarted = false;

    function startDossierTyping() {
      if (dossierStarted) return;
      dossierStarted = true;

      dossierBody.innerHTML = "";
      dossierLineIndex = 0;
      dossierCharIndex = 0;
      dossierCurrentText = "";
      dossierBody.appendChild(dossierCursor);
      typeDossier();
    }

    function typeDossier() {
      const line = dossierLines[dossierLineIndex];

      if (dossierCharIndex < line.length) {
        dossierCurrentText += line[dossierCharIndex];
        renderDossier();
        dossierCharIndex++;
        setTimeout(typeDossier, typingSpeed);
      } else {
        dossierCurrentText += "\n";
        renderDossier();
        dossierLineIndex++;
        dossierCharIndex = 0;

        if (dossierLineIndex < dossierLines.length) {
          setTimeout(typeDossier, linePause);
        }
      }
    }

    function renderDossier() {
      dossierBody.innerHTML = "";
      dossierBody.appendChild(document.createTextNode(dossierCurrentText));
      dossierBody.appendChild(dossierCursor);
    }

    /* ---------- ПРИЛОЖЕНИЯ ---------- */
    const attachmentsBody = document.getElementById("attachments-body");
    const attachmentsCursor = document.createElement("span");
    attachmentsCursor.className = "cursor";

    let attLineIndex = 0;
    let attCharIndex = 0;
    let attCurrentText = "";
    let attachmentsStarted = false;

    function startAttachmentsTyping() {
      if (attachmentsStarted) return;
      attachmentsStarted = true;

      attachmentsBody.innerHTML = "";
      attLineIndex = 0;
      attCharIndex = 0;
      attCurrentText = "";
      attachmentsBody.appendChild(attachmentsCursor);

      typeAttachments();
    }

    function typeAttachments() {
      const line = attachmentLines[attLineIndex];

      if (attCharIndex < line.length) {
        attCurrentText += line[attCharIndex];
        renderAttachments();
        attCharIndex++;
        setTimeout(typeAttachments, typingSpeed);
      } else {
        attCurrentText += "\n";
        renderAttachments();
        attLineIndex++;
        attCharIndex = 0;

        if (attLineIndex < attachmentLines.length) {
          setTimeout(typeAttachments, linePause);
        } else {
          setTimeout(startImageReveal, 600);
        }
      }
    }

    function renderAttachments() {
      attachmentsBody.innerHTML = "";
      attachmentsBody.appendChild(document.createTextNode(attCurrentText));
      attachmentsBody.appendChild(attachmentsCursor);
    } 

    function startImageReveal() {
      const cont = document.getElementById("apps-image-container");
      if (!cont) return;

      // Очистить прошлое содержимое
      cont.innerHTML = "";

      const img = new Image();
      img.src = "attachment1.jpg";   // <-- правильное имя файла

      img.onload = function () {
        const containerWidth = cont.clientWidth || 800;

        // Масштабируем изображение по ширине контейнера
        const scale = containerWidth / img.naturalWidth;
        const finalHeight = img.naturalHeight * scale;

        // Подстраиваем высоту контейнера под картинку (минимум 500)
        const viewsContainer = document.querySelector(".views");
        if (viewsContainer) {
          viewsContainer.style.height = Math.max(500, finalHeight + 200) + "px";
        }

        // Видимый canvas
        const canvas = document.createElement("canvas");
        canvas.width = containerWidth;
        canvas.height = finalHeight;
        cont.appendChild(canvas);
        const ctx = canvas.getContext("2d");

        // Offscreen-canvas, на который один раз рисуем масштабированное изображение
        const off = document.createElement("canvas");
        off.width = containerWidth;
        off.height = finalHeight;
        const offCtx = off.getContext("2d");

        // Полностью масштабированная картинка
        offCtx.drawImage(img, 0, 0, containerWidth, finalHeight);

        let revealed = 0;                 // сколько пикселей по высоте уже "открыто"
        const speed = 4;                  // скорость раскрытия (px за кадр)
        const glyphStepX = 16;            // расстояние между столбцами символов

        function frame() {
          const next = Math.min(revealed + speed, finalHeight);

          // Копируем сверху до next всё изображение с offscreen-canvas
          ctx.drawImage(off, 0, 0, canvas.width, next, 0, 0, canvas.width, next);

          // Поверх – "матрица" только в новой полоске
          ctx.save();
          ctx.globalAlpha = 0.45;        // <= ВАЖНО: картинка под символами видна
          ctx.fillStyle = "#00ff66";
          ctx.font = "14px Consolas";

          for (let x = 0; x < canvas.width; x += glyphStepX) {
            if (Math.random() < 0.25) {
              const y = revealed + Math.random() * (next - revealed);
              ctx.fillText(
                String.fromCharCode(0x30A0 + (Math.random() * 96)),
                x,
                y
              );
            }
          }

          ctx.restore();

          revealed = next;
          if (revealed < finalHeight) {
            requestAnimationFrame(frame);
          } else {
            // OPTIONAL: после полной загрузки можно чуть "почистить" картинку
            // ctx.drawImage(off, 0, 0); // раскомментируй, если хочешь убрать символы
          }
        }

        frame();
      };

      img.onerror = function () {
        console.error("Failed to load image: attachment1.jpg");
        cont.innerHTML = "<p style='color:#ff3333;'>ERROR: Failed to load attachment1.jpg</p>";
      };
    }

    /* ---------- ПЕРЕКЛЮЧЕНИЕ ЭКРАНОВ ---------- */
    const viewsInner = document.getElementById("views-inner");
    const viewsContainer = document.querySelector(".views");

    function goToView(target) {
      switch (target) {
        case "overview":
          viewsInner.style.transform = "translateY(0)";
          setTimeout(() => {
            viewsContainer.classList.remove("expanded");
          }, 600);

          clearProtocolsTimers();   // <--- вот эта строка


          // сбрасываем все экраны
          biometricsBody.innerHTML = "";
          protocolsBody.innerHTML = "";
          dossierBody.innerHTML = "";
          attachmentsBody.innerHTML = "";

          const canvas = document.getElementById("attachmentCanvas");
          if (canvas) canvas.style.display = "none";

          biometricsStarted = false;
          protocolsStarted = false;
          dossierStarted = false;
          attachmentsStarted = false;

          bioLineIndex = bioCharIndex = 0;
          bioCurrentText = "";

          protLineIndex = protCharIndex = 0;
          protCurrentText = "";

          dossierLineIndex = dossierCharIndex = 0;
          dossierCurrentText = "";

          attLineIndex = attCharIndex = 0;
          attCurrentText = "";
          break;

        case "biometrics":
          viewsContainer.classList.add("expanded");
          viewsContainer.style.height = "500px"; // Стандартная высота
          setTimeout(() => {
            viewsInner.style.transform = "translateY(-500px)";
          }, 50);
          setTimeout(startBiometricsTyping, 670);
          break;

        case "protocols":
          viewsContainer.classList.add("expanded");
          viewsContainer.style.height = "500px"; // Стандартная высота
          setTimeout(() => {
            viewsInner.style.transform = "translateY(-1000px)";
          }, 50);
          setTimeout(startProtocolsTyping, 670);
          break;

        case "dossier":
          viewsContainer.classList.add("expanded");
          viewsContainer.style.height = "500px"; // Стандартная высота
          setTimeout(() => {
            viewsInner.style.transform = "translateY(-1500px)";
          }, 50);
          setTimeout(startDossierTyping, 670);
          break;

        case "attachments":
          viewsContainer.classList.add("expanded");
          // Высота будет установлена в startImageReveal
          setTimeout(() => {
            viewsInner.style.transform = "translateY(-2000px)";
          }, 50);
          setTimeout(startAttachmentsTyping, 670);
          break;

        default:
          alert("Раздел \"" + target + "\" ещё не активирован.");
      }
    }

    /* ---------- ОБРАБОТЧИКИ КНОПОК ---------- */
    document.addEventListener("click", (e) => {
      const btn = e.target.closest(".nav-btn");
      if (!btn) return;

      const target = btn.getAttribute("data-target");
      if (!target) return;

      e.preventDefault();
      if (["biometrics", "overview", "protocols", "dossier", "attachments"].includes(target)) {
        goToView(target);
      } else {
        goToView(target);
      }
    });

    /* ---------- ЗАПУСК ОБЗОРА ---------- */
    window.addEventListener("load", () => {
      typeOverview();
    });
  </script>
</body>
</html>
